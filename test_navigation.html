<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation PhotoSwipe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #005a87;
        }
        .status {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .success {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        .warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Navigation PhotoSwipe</h1>
        <p>C√¥ng c·ª• ki·ªÉm tra t√≠nh nƒÉng l∆∞·ªõt preview li√™n t·ª•c c·ªßa PhotoSwipe gallery.</p>
        
        <div class="test-section">
            <h3>Ki·ªÉm tra C·∫•u h√¨nh</h3>
            <button class="test-button" onclick="checkConfig()">Ki·ªÉm tra Config</button>
            <button class="test-button" onclick="checkPhotoSwipeState()">Ki·ªÉm tra State</button>
            <button class="test-button" onclick="checkEventListeners()">Ki·ªÉm tra Event Listeners</button>
        </div>

        <div class="test-section">
            <h3>Test Navigation</h3>
            <button class="test-button" onclick="testBasicNavigation()">Test Navigation C∆° b·∫£n</button>
            <button class="test-button" onclick="testLazyLoading()">Test Lazy Loading</button>
            <button class="test-button" onclick="simulateNavigateNearEnd()">Test Load More Near End</button>
        </div>

        <div class="test-section">
            <h3>Debug Tools</h3>
            <button class="test-button" onclick="openConsoleDebug()">M·ªü Console Debug</button>
            <button class="test-button" onclick="checkCurrentData()">Ki·ªÉm tra D·ªØ li·ªáu Hi·ªán t·∫°i</button>
            <button class="test-button" onclick="resetAndReload()">Reset & Reload</button>
        </div>

        <div id="status" class="status">
S·∫µn s√†ng ki·ªÉm tra. Nh·∫•n c√°c n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu test...
        </div>
    </div>

    <script type="module">
        import { PREVIEW_LOADING_STRATEGY, PREVIEW_NEAR_END_THRESHOLD } from './js/config.js';
        
        let currentImageList = null;
        let totalImages = 0;
        let photoswipeLightbox = null;

        // Make functions global for button clicks
        window.checkConfig = function() {
            updateStatus(`üìã C·∫•u h√¨nh PhotoSwipe:
Loading Strategy: ${PREVIEW_LOADING_STRATEGY}
Near End Threshold: ${PREVIEW_NEAR_END_THRESHOLD}

Strategy n√†y c√≥ nghƒ©a:
- ${PREVIEW_LOADING_STRATEGY === 'LAZY_LOAD_ON_NAVIGATE' ? 'Ch·ªâ load th√™m ·∫£nh khi g·∫ßn cu·ªëi danh s√°ch' : 'Load t·∫•t c·∫£ ·∫£nh khi m·ªü preview'}
- Trigger loading khi c√≤n ${PREVIEW_NEAR_END_THRESHOLD} ·∫£nh n·ªØa l√† ƒë·∫øn cu·ªëi`, 'success');
        };

        window.checkPhotoSwipeState = async function() {
            try {
                // Check if we can access state
                const stateModule = await import('./js/state.js');
                const { currentImageList, totalImages, currentPage, isLoadingMore } = stateModule;
                
                updateStatus(`üìä State hi·ªán t·∫°i:
Current Image List: ${currentImageList ? currentImageList.length + ' ·∫£nh' : 'Ch∆∞a c√≥'}
Total Images: ${totalImages || 'Ch∆∞a x√°c ƒë·ªãnh'}
Current Page: ${currentPage || 0}
Is Loading More: ${isLoadingMore || false}

PhotoSwipe Instance: ${photoswipeLightbox ? 'ƒê√£ kh·ªüi t·∫°o' : 'Ch∆∞a kh·ªüi t·∫°o'}`, 'success');
                
            } catch (error) {
                updateStatus(`‚ùå L·ªói khi ki·ªÉm tra state: ${error.message}`, 'error');
            }
        };

        window.checkEventListeners = function() {
            // Check if PhotoSwipe change event is working
            if (typeof window.debugPhotoSwipe !== 'undefined') {
                updateStatus(`‚úÖ Debug functions c√≥ s·∫µn:
- window.debugPhotoSwipe.testWithCurrentData()
- window.debugPhotoSwipe.testWithFakeData()
- window.debugPhotoSwipe.checkState()
- window.debugPhotoSwipe.getCurrentImageList()

Event listeners ƒë∆∞·ª£c thi·∫øt l·∫≠p trong setupPhotoSwipeIfNeeded().
Ki·ªÉm tra console log khi navigation ƒë·ªÉ xem events c√≥ fire kh√¥ng.`, 'success');
            } else {
                updateStatus(`‚ö†Ô∏è Debug functions ch∆∞a s·∫µn s√†ng.
C√≥ th·ªÉ photoswipeHandler.js ch∆∞a ƒë∆∞·ª£c load ho·∫∑c c√≥ l·ªói.`, 'warning');
            }
        };

        window.testBasicNavigation = async function() {
            try {
                if (typeof window.debugPhotoSwipe !== 'undefined') {
                    const state = await window.debugPhotoSwipe.checkState();
                    
                    updateStatus(`üß™ Test Navigation C∆° b·∫£n:
Image List: ${state.currentImageList.available ? 'C√≥' : 'Kh√¥ng'}
Image Count: ${state.currentImageList.length}
Total Images: ${state.totalImages}

Strategy: ${state.strategy}

${state.currentImageList.length > 0 ? 'Th·ª≠ m·ªü PhotoSwipe v·ªõi ·∫£nh ƒë·∫ßu ti√™n...' : 'Kh√¥ng c√≥ ·∫£nh ƒë·ªÉ test'}`, 'success');

                    if (state.currentImageList.length > 0) {
                        // Try to open PhotoSwipe with first image
                        await window.debugPhotoSwipe.testWithCurrentData(0);
                    }
                } else {
                    updateStatus(`‚ùå Debug functions kh√¥ng s·∫µn s√†ng`, 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå L·ªói test navigation: ${error.message}`, 'error');
            }
        };

        window.testLazyLoading = async function() {
            try {
                if (typeof window.debugPhotoSwipe !== 'undefined') {
                    const state = await window.debugPhotoSwipe.checkState();
                    
                    updateStatus(`üîÑ Test Lazy Loading:
Hi·ªán c√≥: ${state.currentImageList.length} ·∫£nh
T·ªïng s·ªë: ${state.totalImages} ·∫£nh
Strategy: ${state.strategy}

${state.strategy === 'LAZY_LOAD_ON_NAVIGATE' ? 
    'Lazy loading ƒê∆Ø·ª¢C B·∫¨T - s·∫Ω load th√™m khi navigate g·∫ßn cu·ªëi' : 
    'Load all ON OPEN - t·∫•t c·∫£ ·∫£nh ƒë∆∞·ª£c load khi m·ªü'}

${state.currentImageList.length < state.totalImages ? 
    'C√≤n ·∫£nh ƒë·ªÉ load, th·ª≠ navigation ƒë·∫øn g·∫ßn cu·ªëi...' : 
    'ƒê√£ load h·∫øt ·∫£nh'}`, 'success');

                    // Test navigate to near end if we have enough images
                    if (state.currentImageList.length >= PREVIEW_NEAR_END_THRESHOLD) {
                        const nearEndIndex = state.currentImageList.length - PREVIEW_NEAR_END_THRESHOLD + 1;
                        await window.debugPhotoSwipe.testWithCurrentData(nearEndIndex);
                    }
                } else {
                    updateStatus(`‚ùå Debug functions kh√¥ng s·∫µn s√†ng`, 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå L·ªói test lazy loading: ${error.message}`, 'error');
            }
        };

        window.simulateNavigateNearEnd = async function() {
            try {
                if (typeof window.debugPhotoSwipe !== 'undefined') {
                    const imageList = await window.debugPhotoSwipe.getCurrentImageList();
                    
                    if (imageList && imageList.length > PREVIEW_NEAR_END_THRESHOLD) {
                        const nearEndIndex = imageList.length - PREVIEW_NEAR_END_THRESHOLD + 1;
                        
                        updateStatus(`üéØ Simulate Navigate Near End:
T·ªïng ·∫£nh hi·ªán t·∫°i: ${imageList.length}
Threshold: ${PREVIEW_NEAR_END_THRESHOLD}
Navigate ƒë·∫øn index: ${nearEndIndex}

M·ªü PhotoSwipe v√† navigate ƒë·∫øn g·∫ßn cu·ªëi ƒë·ªÉ test lazy loading...`, 'success');

                        await window.debugPhotoSwipe.testWithCurrentData(nearEndIndex);
                    } else {
                        updateStatus(`‚ö†Ô∏è Kh√¥ng ƒë·ªß ·∫£nh ƒë·ªÉ test near end navigation.
C·∫ßn √≠t nh·∫•t ${PREVIEW_NEAR_END_THRESHOLD + 1} ·∫£nh.
Hi·ªán c√≥: ${imageList ? imageList.length : 0} ·∫£nh`, 'warning');
                    }
                } else {
                    updateStatus(`‚ùå Debug functions kh√¥ng s·∫µn s√†ng`, 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå L·ªói simulate near end: ${error.message}`, 'error');
            }
        };

        window.openConsoleDebug = function() {
            updateStatus(`üîß Console Debug Commands:

M·ªü DevTools Console v√† ch·∫°y:

// Ki·ªÉm tra state hi·ªán t·∫°i
await window.debugPhotoSwipe.checkState()

// Test v·ªõi d·ªØ li·ªáu hi·ªán t·∫°i
await window.debugPhotoSwipe.testWithCurrentData(0)

// Test v·ªõi fake data
await window.debugPhotoSwipe.testWithFakeData(0)

// Ki·ªÉm tra image list
await window.debugPhotoSwipe.getCurrentImageList()

// Test simple
window.simplePhotoSwipeTest()

L∆∞u √Ω: M·ªü console ƒë·ªÉ xem log messages khi navigation!`, 'success');
        };

        window.checkCurrentData = async function() {
            try {
                if (typeof window.simplePhotoSwipeTest !== 'undefined') {
                    const result = await window.simplePhotoSwipeTest();
                    
                    updateStatus(`üìã D·ªØ li·ªáu hi·ªán t·∫°i:
Has Image List: ${result.hasImageList}
Image Count: ${result.imageCount}
Total Images: ${result.totalImages}

${result.error ? `L·ªói: ${result.error}` : 'D·ªØ li·ªáu OK'}

${result.imageCount === 0 ? 
    'Ch∆∞a c√≥ ·∫£nh - h√£y browse m·ªôt folder tr∆∞·ªõc' : 
    'C√≥ th·ªÉ test navigation'}`, 
                    result.error ? 'error' : 'success');
                } else {
                    updateStatus(`‚ùå simplePhotoSwipeTest kh√¥ng s·∫µn s√†ng`, 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå L·ªói check current data: ${error.message}`, 'error');
            }
        };

        window.resetAndReload = function() {
            updateStatus(`üîÑ Reset v√† reload trang...`, 'warning');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        };

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        // Auto check on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                updateStatus(`‚úÖ Test tool ƒë√£ s·∫µn s√†ng!

H∆∞·ªõng d·∫´n test:
1. M·ªü gallery ch√≠nh (index.php) trong tab kh√°c
2. Browse m·ªôt folder c√≥ nhi·ªÅu ·∫£nh (>20 ·∫£nh)  
3. Quay l·∫°i ƒë√¢y v√† ch·∫°y c√°c test
4. Ki·ªÉm tra console log khi test navigation

N·∫øu navigation kh√¥ng ho·∫°t ƒë·ªông:
- Ki·ªÉm tra config strategy
- Xem console errors
- Test v·ªõi fake data`, 'success');
            }, 500);
        });
    </script>
</body>
</html> 